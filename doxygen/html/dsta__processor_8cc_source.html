<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>mocha: Y:/mocha/src/ast/visitors/utils/processors/dsta_processor.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">mocha</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">Y:/mocha/src/ast/visitors/utils/processors/dsta_processor.cc</div>  </div>
</div>
<div class="contents">
<a href="dsta__processor_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="dsta__processor_8h.html">ast/visitors/utils/processors/dsta_processor.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="processor__info_8h.html">ast/visitors/utils/processors/processor_info.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="visitor__info_8h.html">ast/visitors/utils/visitor_info.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="ast__utils_8h.html">ast/utils/ast_utils.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="managed__handle_8h.html">utils/pool/managed_handle.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="compiler_8h.html">compiler/compiler.h</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="js__token_8h.html">compiler/tokens/js_token.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="token__info_8h.html">compiler/tokens/token_info.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="symbol__list_8h.html">compiler/tokens/symbol_list.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="exception__handler_8h.html">compiler/utils/exception_handler.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="grammar_8tab_8hh.html">grammar/grammar.tab.hh</a>&gt;</span>
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="dsta__processor_8cc.html#a04742d7f90e8442694c6966153e818a2">00037</a> <span class="preprocessor">#define ERROR(info,func)                                                \</span>
<a name="l00038"></a>00038 <span class="preprocessor">  //AST_ERROR( ( info-&gt;GetInfo() ) , &quot;mocha bugs in DstaProcessor::&quot;#func&quot;.&quot; )</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span>
<a name="l00040"></a><a class="code" href="dsta__processor_8cc.html#a5c3a83864bf5991d09aa5c2abb911bf0">00040</a> <span class="preprocessor">#define TOKEN yy::ParserImplementation::token</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>
<a name="l00042"></a>00042 <span class="keyword">namespace </span>mocha {
<a name="l00043"></a>00043 
<a name="l00068"></a><a class="code" href="dsta__processor_8cc.html#a19ff393b4360cbfec2b96ba18961fdb7">00068</a> <span class="preprocessor">#define UPDATE_TREE                             \</span>
<a name="l00069"></a>00069 <span class="preprocessor">  if ( depth == 0 ) {                           \</span>
<a name="l00070"></a>00070 <span class="preprocessor">    tree = ManagedHandle::Retain&lt;DstaTree&gt;();   \</span>
<a name="l00071"></a>00071 <span class="preprocessor">  } else {                                      \</span>
<a name="l00072"></a>00072 <span class="preprocessor">    tree = tree-&gt;Clone()-&gt;CastToDstaTree();     \</span>
<a name="l00073"></a>00073 <span class="preprocessor">    tree-&gt;RemoveChild( tree-&gt;LastChild() );     \</span>
<a name="l00074"></a>00074 <span class="preprocessor">  }</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span>
<a name="l00076"></a>00076 <span class="comment">//prototypes.</span>
<a name="l00077"></a>00077 <span class="keywordtype">void</span> <a class="code" href="namespacemocha.html#a52d7a3f3bf8de146d1e05760aa7463dc" title="Iterate Object pattern like var { x, y , z : { x } } = {...}.">ProcessObject</a>( ValueNode* ast_node , DstaTree* tree , <span class="keywordtype">int</span> depth , ProcessorInfo* info );
<a name="l00078"></a>00078 <span class="keywordtype">void</span> <a class="code" href="namespacemocha.html#ae7216e54bbad37a8eb20cdf819e3cc0b" title="Process Array pattern.">ProcessArray</a>( ValueNode* ast_node , DstaTree* tree , <span class="keywordtype">int</span> depth , ProcessorInfo* info );
<a name="l00079"></a>00079 
<a name="l00084"></a><a class="code" href="namespacemocha.html#adb1a85a8064e46a4ad0109ead9aba3e8">00084</a> <span class="keywordtype">void</span> <a class="code" href="namespacemocha.html#adb1a85a8064e46a4ad0109ead9aba3e8" title="Process the Object pattern&#39;s property member.">ProcessMember</a>( <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>* ast_node , <a class="code" href="classmocha_1_1_dsta_tree.html">DstaTree</a>* tree , <a class="code" href="classmocha_1_1_processor_info.html">ProcessorInfo</a>* proc_info ) {
<a name="l00085"></a>00085   <a class="code" href="classmocha_1_1_visitor_info.html">VisitorInfo</a> *visitor_info = proc_info-&gt;<a class="code" href="classmocha_1_1_processor_info.html#ab6c1f1d981b047d0d4967da546402905">GetInfo</a>();
<a name="l00086"></a>00086   <a class="code" href="classmocha_1_1_token_info.html">TokenInfo</a>* info = ast_node-&gt;<a class="code" href="classmocha_1_1_value_node.html#a769c0c221283cca863964f6cf673c170">Symbol</a>();
<a name="l00087"></a>00087   <span class="keywordflow">switch</span>( info-&gt;<a class="code" href="classmocha_1_1_token_info.html#a36fc04622e34f258f4a638a1af20858b">GetType</a>() ) {
<a name="l00088"></a>00088     <span class="comment">//In case of { Identifier : ... } or { Identifier }</span>
<a name="l00089"></a>00089     <span class="keywordflow">case</span> <a class="code" href="classmocha_1_1_token.html#ad91b4584085a00e1cfe54b275a2c466aa31d9591b4608e04caeb5f7642045700a">Token::JS_IDENTIFIER</a> : {
<a name="l00090"></a>00090       <span class="keywordflow">if</span> ( tree-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a6ecb0925a6380a375a92451256039d7f">ChildLength</a>() &gt; 0 ) {
<a name="l00091"></a>00091         <span class="comment">/*</span>
<a name="l00092"></a>00092 <span class="comment">         * If the Tree has the one or more children,</span>
<a name="l00093"></a>00093 <span class="comment">         * connect new identifier accessor to the tree last accessor expressions.</span>
<a name="l00094"></a>00094 <span class="comment">         */</span>
<a name="l00095"></a>00095         <a class="code" href="classmocha_1_1_call_exp.html">CallExp</a>* dot_accessor = <a class="code" href="classmocha_1_1_ast_utils.html#aed7efcb40804b8b9e3740a49519fa41a">AstUtils::CreateDotAccessor</a>( tree-&gt;<a class="code" href="classmocha_1_1_ast_node.html#ad1a001a8c53bf5f73d4e81096f0f41be">LastChild</a>() , ast_node );
<a name="l00096"></a>00096         tree-&gt;<a class="code" href="classmocha_1_1_ast_node.html#acada63e4d868960a7fbd972f3d3a0ae4">AddChild</a>( dot_accessor );
<a name="l00097"></a>00097       } <span class="keywordflow">else</span> {
<a name="l00098"></a>00098         <span class="comment">/*</span>
<a name="l00099"></a>00099 <span class="comment">         * If the Tree hasn&#39;t children,</span>
<a name="l00100"></a>00100 <span class="comment">         * add first identifier accessor to tree.</span>
<a name="l00101"></a>00101 <span class="comment">         */</span>
<a name="l00102"></a>00102         <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a>* node = visitor_info-&gt;<a class="code" href="classmocha_1_1_visitor_info.html#a60fd8ce138f8e41d8694c349b741cb64">GetCurrentStmt</a>()-&gt;<a class="code" href="classmocha_1_1_statement.html#ae1802b82da424cefda6c890563ff2e11">GetDsta</a>()-&gt;<a class="code" href="classmocha_1_1_dsta_extracted_expressions.html#afda6e6826138e547c3cb524e33eb16f9">Refs</a>()-&gt;<a class="code" href="classmocha_1_1_ast_node.html#ad1a001a8c53bf5f73d4e81096f0f41be">LastChild</a>()-&gt;<a class="code" href="classmocha_1_1_ast_node.html#af2a895699bac2012f8b7739bff49c5ec">Clone</a>();
<a name="l00103"></a>00103         <a class="code" href="classmocha_1_1_call_exp.html">CallExp</a>* dot_accessor = <a class="code" href="classmocha_1_1_ast_utils.html#aed7efcb40804b8b9e3740a49519fa41a">AstUtils::CreateDotAccessor</a>( node , ast_node );
<a name="l00104"></a>00104         tree-&gt;<a class="code" href="classmocha_1_1_ast_node.html#acada63e4d868960a7fbd972f3d3a0ae4">AddChild</a>( dot_accessor );
<a name="l00105"></a>00105       }
<a name="l00106"></a>00106     }
<a name="l00107"></a>00107       <span class="keywordflow">break</span>;
<a name="l00108"></a>00108       <span class="comment">//In case of { &quot;string&quot; : ... } or { 0 : ... }</span>
<a name="l00109"></a>00109     <span class="keywordflow">case</span> <a class="code" href="classmocha_1_1_token.html#ad91b4584085a00e1cfe54b275a2c466aaa34d928a3c27d343f0319b5a107e831b">Token::JS_NUMERIC_LITERAL</a> :
<a name="l00110"></a>00110     <span class="keywordflow">case</span> <a class="code" href="classmocha_1_1_token.html#ad91b4584085a00e1cfe54b275a2c466aa74ae1f8e3b0701db2bd560658647d586">Token::JS_STRING_LITERAL</a> : {
<a name="l00111"></a>00111       <span class="keywordflow">if</span> ( tree-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a6ecb0925a6380a375a92451256039d7f">ChildLength</a>() &gt; 0 ) {
<a name="l00112"></a>00112         <span class="comment">//As stated above, connect node.</span>
<a name="l00113"></a>00113         <a class="code" href="classmocha_1_1_call_exp.html">CallExp</a>* arr_accessor = <a class="code" href="classmocha_1_1_ast_utils.html#a73682172af76ec16a106911d7546180f">AstUtils::CreateArrayAccessor</a>( tree-&gt;<a class="code" href="classmocha_1_1_ast_node.html#ad1a001a8c53bf5f73d4e81096f0f41be">LastChild</a>() , ast_node );
<a name="l00114"></a>00114         tree-&gt;<a class="code" href="classmocha_1_1_ast_node.html#acada63e4d868960a7fbd972f3d3a0ae4">AddChild</a>( arr_accessor );
<a name="l00115"></a>00115       } <span class="keywordflow">else</span> {
<a name="l00116"></a>00116         <span class="comment">//Same as above.</span>
<a name="l00117"></a>00117         <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a>* node = visitor_info-&gt;<a class="code" href="classmocha_1_1_visitor_info.html#a60fd8ce138f8e41d8694c349b741cb64">GetCurrentStmt</a>()-&gt;<a class="code" href="classmocha_1_1_statement.html#ae1802b82da424cefda6c890563ff2e11">GetDsta</a>()-&gt;<a class="code" href="classmocha_1_1_dsta_extracted_expressions.html#afda6e6826138e547c3cb524e33eb16f9">Refs</a>()-&gt;<a class="code" href="classmocha_1_1_ast_node.html#ad1a001a8c53bf5f73d4e81096f0f41be">LastChild</a>();
<a name="l00118"></a>00118         <a class="code" href="classmocha_1_1_call_exp.html">CallExp</a>* arr_accessor = <a class="code" href="classmocha_1_1_ast_utils.html#a73682172af76ec16a106911d7546180f">AstUtils::CreateArrayAccessor</a>( node , ast_node );
<a name="l00119"></a>00119         tree-&gt;<a class="code" href="classmocha_1_1_ast_node.html#acada63e4d868960a7fbd972f3d3a0ae4">AddChild</a>( arr_accessor );
<a name="l00120"></a>00120       }
<a name="l00121"></a>00121     }
<a name="l00122"></a>00122       <span class="keywordflow">break</span>;
<a name="l00123"></a>00123       
<a name="l00124"></a>00124   }
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 
<a name="l00131"></a><a class="code" href="namespacemocha.html#a23f9553bc80e3ea1df3feda5667c0282">00131</a> <a class="code" href="classmocha_1_1_dsta_tree.html">DstaTree</a>* <a class="code" href="namespacemocha.html#a23f9553bc80e3ea1df3feda5667c0282" title="Process { x : &lt;...&gt; } or { &lt;...&gt; }.">ProcessPropertyMember</a>( <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>* value , <a class="code" href="classmocha_1_1_dsta_tree.html">DstaTree</a>* tree , <a class="code" href="classmocha_1_1_processor_info.html">ProcessorInfo</a>* info , <span class="keywordtype">int</span> depth ) {
<a name="l00132"></a>00132   <a class="code" href="classmocha_1_1_visitor_info.html">VisitorInfo</a>* visitor_info = info-&gt;<a class="code" href="classmocha_1_1_processor_info.html#ab6c1f1d981b047d0d4967da546402905">GetInfo</a>();
<a name="l00133"></a>00133   <span class="keywordflow">if</span> ( value-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a6ecb0925a6380a375a92451256039d7f">ChildLength</a>() &gt; 0 ) {
<a name="l00134"></a>00134     <a class="code" href="namespacemocha.html#adb1a85a8064e46a4ad0109ead9aba3e8" title="Process the Object pattern&#39;s property member.">ProcessMember</a>( value , tree , info );
<a name="l00135"></a>00135     <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a>* child_node = value-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a65c6f1546ebb657cbfb265f372c183cd">FirstChild</a>();
<a name="l00136"></a>00136     <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>* prop = child_node-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a21324d298123937056c972179d03fade">CastToValue</a>();
<a name="l00137"></a>00137     <span class="keywordflow">if</span> ( prop ) {
<a name="l00138"></a>00138       <span class="keywordflow">if</span> ( prop-&gt;<a class="code" href="classmocha_1_1_value_node.html#ae400f4a35352d1052dffc60290c290a0">ValueType</a>() == <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba7dd7e98941f05c893b04c6aed9e00fb1">ValueNode::kDst</a> || prop-&gt;<a class="code" href="classmocha_1_1_value_node.html#ae400f4a35352d1052dffc60290c290a0">ValueType</a>() == <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba839c61798b67a9f67787b8cd6c401a65">ValueNode::kObject</a> ) {
<a name="l00139"></a>00139         <a class="code" href="namespacemocha.html#a52d7a3f3bf8de146d1e05760aa7463dc" title="Iterate Object pattern like var { x, y , z : { x } } = {...}.">ProcessObject</a>( prop , tree , ( depth + 1 ) , info );
<a name="l00140"></a>00140         <a class="code" href="dsta__processor_8cc.html#a19ff393b4360cbfec2b96ba18961fdb7" title="We express destructuring assingment as dsta.">UPDATE_TREE</a>;
<a name="l00141"></a>00141       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( prop-&gt;<a class="code" href="classmocha_1_1_value_node.html#ae400f4a35352d1052dffc60290c290a0">ValueType</a>() == <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba0a1b856b8d8208cd083c671371e62711">ValueNode::kDstArray</a> || prop-&gt;<a class="code" href="classmocha_1_1_value_node.html#ae400f4a35352d1052dffc60290c290a0">ValueType</a>() == <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba95cda68e2b88f59d7c6d539246d5ea77">ValueNode::kArray</a> ) {
<a name="l00142"></a>00142         <a class="code" href="namespacemocha.html#ae7216e54bbad37a8eb20cdf819e3cc0b" title="Process Array pattern.">ProcessArray</a>( prop , tree , ( depth + 1 ) , info );
<a name="l00143"></a>00143         <a class="code" href="dsta__processor_8cc.html#a19ff393b4360cbfec2b96ba18961fdb7" title="We express destructuring assingment as dsta.">UPDATE_TREE</a>;
<a name="l00144"></a>00144       } <span class="keywordflow">else</span> {
<a name="l00145"></a>00145         prop-&gt;<a class="code" href="classmocha_1_1_value_node.html#ae400f4a35352d1052dffc60290c290a0">ValueType</a>( <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba70b4c10f3806f4de5c5f67bce258b5cb">ValueNode::kProperty</a> );
<a name="l00146"></a>00146         tree-&gt;<a class="code" href="classmocha_1_1_dsta_tree.html#a6ef49ba20cdae2f5885f859e6ea7c9c1">Symbol</a>( prop );
<a name="l00147"></a>00147         visitor_info-&gt;<a class="code" href="classmocha_1_1_visitor_info.html#a60fd8ce138f8e41d8694c349b741cb64">GetCurrentStmt</a>()-&gt;<a class="code" href="classmocha_1_1_statement.html#ae1802b82da424cefda6c890563ff2e11">GetDsta</a>()-&gt;<a class="code" href="classmocha_1_1_ast_node.html#ad1a001a8c53bf5f73d4e81096f0f41be">LastChild</a>()-&gt;<a class="code" href="classmocha_1_1_ast_node.html#acada63e4d868960a7fbd972f3d3a0ae4">AddChild</a>( tree );
<a name="l00148"></a>00148         <a class="code" href="dsta__processor_8cc.html#a19ff393b4360cbfec2b96ba18961fdb7" title="We express destructuring assingment as dsta.">UPDATE_TREE</a>;
<a name="l00149"></a>00149       }
<a name="l00150"></a>00150     }
<a name="l00151"></a>00151   } <span class="keywordflow">else</span> {
<a name="l00152"></a>00152     value-&gt;<a class="code" href="classmocha_1_1_value_node.html#ae400f4a35352d1052dffc60290c290a0">ValueType</a>( <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba70b4c10f3806f4de5c5f67bce258b5cb">ValueNode::kProperty</a> );
<a name="l00153"></a>00153     tree-&gt;<a class="code" href="classmocha_1_1_dsta_tree.html#a6ef49ba20cdae2f5885f859e6ea7c9c1">Symbol</a>( value );
<a name="l00154"></a>00154     <a class="code" href="namespacemocha.html#adb1a85a8064e46a4ad0109ead9aba3e8" title="Process the Object pattern&#39;s property member.">ProcessMember</a>( value , tree , info );
<a name="l00155"></a>00155     visitor_info-&gt;<a class="code" href="classmocha_1_1_visitor_info.html#a60fd8ce138f8e41d8694c349b741cb64">GetCurrentStmt</a>()-&gt;<a class="code" href="classmocha_1_1_statement.html#ae1802b82da424cefda6c890563ff2e11">GetDsta</a>()-&gt;<a class="code" href="classmocha_1_1_ast_node.html#ad1a001a8c53bf5f73d4e81096f0f41be">LastChild</a>()-&gt;<a class="code" href="classmocha_1_1_ast_node.html#acada63e4d868960a7fbd972f3d3a0ae4">AddChild</a>( tree );
<a name="l00156"></a>00156     <a class="code" href="dsta__processor_8cc.html#a19ff393b4360cbfec2b96ba18961fdb7" title="We express destructuring assingment as dsta.">UPDATE_TREE</a>;
<a name="l00157"></a>00157   }
<a name="l00158"></a>00158   <span class="keywordflow">return</span> tree;
<a name="l00159"></a>00159 }
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 
<a name="l00162"></a>00162 
<a name="l00167"></a><a class="code" href="namespacemocha.html#a52d7a3f3bf8de146d1e05760aa7463dc">00167</a> <span class="keywordtype">void</span> <a class="code" href="namespacemocha.html#a52d7a3f3bf8de146d1e05760aa7463dc" title="Iterate Object pattern like var { x, y , z : { x } } = {...}.">ProcessObject</a>( <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>* ast_node , <a class="code" href="classmocha_1_1_dsta_tree.html">DstaTree</a>* tree , <span class="keywordtype">int</span> depth , <a class="code" href="classmocha_1_1_processor_info.html">ProcessorInfo</a>* info ) {
<a name="l00168"></a>00168   <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a>* child = ast_node-&gt;<a class="code" href="classmocha_1_1_value_node.html#a88025ff701eebee191dc5783a2c161c7">Node</a>();
<a name="l00169"></a>00169   <span class="keywordtype">int</span> value_type = ast_node-&gt;<a class="code" href="classmocha_1_1_value_node.html#ae400f4a35352d1052dffc60290c290a0">ValueType</a>();
<a name="l00170"></a>00170   <span class="keywordtype">bool</span> is_child = ( child &amp;&amp;
<a name="l00171"></a>00171                     ( value_type == <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba7dd7e98941f05c893b04c6aed9e00fb1">ValueNode::kDst</a> ||
<a name="l00172"></a>00172                       value_type == <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba0a1b856b8d8208cd083c671371e62711">ValueNode::kDstArray</a> ) &amp;&amp;
<a name="l00173"></a>00173                     child-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a6ecb0925a6380a375a92451256039d7f">ChildLength</a>() &gt; 0 &amp;&amp; !child-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a31dd8fcdbeb4b1a6aae660a64a1aac99">IsEmpty</a>() );
<a name="l00174"></a>00174   <a class="code" href="classmocha_1_1_node_iterator.html">NodeIterator</a> iterator = ( is_child )? child-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a3c769907079ab97a2970d6b54d137ab0">ChildNodes</a>() : ast_node-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a3c769907079ab97a2970d6b54d137ab0">ChildNodes</a>();
<a name="l00175"></a>00175   <span class="comment">//Iterate member.</span>
<a name="l00176"></a>00176   <span class="keywordflow">while</span> ( iterator.<a class="code" href="classmocha_1_1_node_iterator.html#ae3ce9ed39cc570c83549498c121c0150">HasNext</a>() ) {
<a name="l00177"></a>00177     <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a>* node = iterator.<a class="code" href="classmocha_1_1_node_iterator.html#acc2e3f06c89bb07d2d64f2c024900d5b">Next</a>();
<a name="l00178"></a>00178     <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>* value = node-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a21324d298123937056c972179d03fade">CastToValue</a>();
<a name="l00179"></a>00179     <span class="keywordflow">if</span> ( value ) {
<a name="l00180"></a>00180       <span class="keywordflow">switch</span> ( value-&gt;<a class="code" href="classmocha_1_1_value_node.html#ae400f4a35352d1052dffc60290c290a0">ValueType</a>() ) {
<a name="l00181"></a>00181         <span class="keywordflow">case</span> <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba5452da740cc307738989031c4aca14f9">ValueNode::kNumeric</a> :
<a name="l00182"></a>00182         <span class="keywordflow">case</span> <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba0393f547a3f38d96be62dad44f848111">ValueNode::kString</a> :
<a name="l00183"></a>00183         <span class="keywordflow">case</span> <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba70b4c10f3806f4de5c5f67bce258b5cb">ValueNode::kProperty</a> :
<a name="l00184"></a>00184         <span class="keywordflow">case</span> <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba9076c94a3f40287b5942daca9d41b711">ValueNode::kIdentifier</a> : {
<a name="l00185"></a>00185           tree = <a class="code" href="namespacemocha.html#a23f9553bc80e3ea1df3feda5667c0282" title="Process { x : &lt;...&gt; } or { &lt;...&gt; }.">ProcessPropertyMember</a>( value , tree , info , depth );
<a name="l00186"></a>00186         }
<a name="l00187"></a>00187           <span class="keywordflow">break</span>;
<a name="l00188"></a>00188         <span class="keywordflow">default</span> :
<a name="l00189"></a>00189           <a class="code" href="dsta__processor_8cc.html#a04742d7f90e8442694c6966153e818a2">ERROR</a>( info , <span class="stringliteral">&quot;ProcessObject&quot;</span> );
<a name="l00190"></a>00190       }
<a name="l00191"></a>00191     }
<a name="l00192"></a>00192   }
<a name="l00193"></a>00193 }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 
<a name="l00196"></a>00196 
<a name="l00197"></a><a class="code" href="namespacemocha.html#a1e0321e63212cb250b296eb1958fde95">00197</a> <span class="keywordtype">void</span> <a class="code" href="namespacemocha.html#a1e0321e63212cb250b296eb1958fde95">ArrayHelper</a>( <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>* ast_node,
<a name="l00198"></a>00198                   <a class="code" href="classmocha_1_1_visitor_info.html">VisitorInfo</a>* visitor_info,
<a name="l00199"></a>00199                   <a class="code" href="classmocha_1_1_dsta_tree.html">DstaTree</a>* tree,
<a name="l00200"></a>00200                   <span class="keywordtype">int</span> index,
<a name="l00201"></a>00201                   <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>* symbol,
<a name="l00202"></a>00202                   <span class="keywordtype">bool</span> is_rest ) {
<a name="l00203"></a>00203   <span class="keywordtype">char</span> tmp_index[ 10 ];
<a name="l00204"></a>00204   sprintf( tmp_index , <span class="stringliteral">&quot;%d&quot;</span> , index );
<a name="l00205"></a>00205   <a class="code" href="classmocha_1_1_token_info.html">TokenInfo</a>* info = <a class="code" href="classmocha_1_1_managed_handle.html#a37d5506197f103b180d88f19f3b7d2b5">ManagedHandle::Retain</a>( <span class="keyword">new</span> <a class="code" href="classmocha_1_1_token_info.html">TokenInfo</a>( tmp_index,
<a name="l00206"></a>00206                                                           <a class="code" href="classmocha_1_1_token.html#ad91b4584085a00e1cfe54b275a2c466aaa34d928a3c27d343f0319b5a107e831b">Token::JS_NUMERIC_LITERAL</a> , ast_node-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a6bda7ec5e55d6baa2afc4ab4300caaf1">Line</a>() ) );
<a name="l00207"></a>00207   <a class="code" href="classmocha_1_1_call_exp.html">CallExp</a>* exp;
<a name="l00208"></a>00208   <span class="keywordflow">if</span> ( is_rest ) {
<a name="l00209"></a>00209     <a class="code" href="classmocha_1_1_node_list.html">NodeList</a>* list = ManagedHandle::Retain&lt;NodeList&gt;();
<a name="l00210"></a>00210     <span class="keywordtype">char</span> num[50];
<a name="l00211"></a>00211     sprintf( num , <span class="stringliteral">&quot;%d&quot;</span> , index );
<a name="l00212"></a>00212     <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>* arg = <a class="code" href="classmocha_1_1_ast_utils.html#a1a4ad629469bdb21a0b4b67023c416f1">AstUtils::CreateNameNode</a>( num , <a class="code" href="classmocha_1_1_token.html#ad91b4584085a00e1cfe54b275a2c466aaa34d928a3c27d343f0319b5a107e831b">Token::JS_NUMERIC_LITERAL</a> , ast_node-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a6bda7ec5e55d6baa2afc4ab4300caaf1">Line</a>() , <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba5452da740cc307738989031c4aca14f9">ValueNode::kNumeric</a> );
<a name="l00213"></a>00213     <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>* to_array = <a class="code" href="classmocha_1_1_ast_utils.html#a1a4ad629469bdb21a0b4b67023c416f1">AstUtils::CreateNameNode</a>( <a class="code" href="classmocha_1_1_symbol_list.html#ae1c6ed56e340562976099133b2c258d0">SymbolList::GetSymbol</a>( <a class="code" href="classmocha_1_1_symbol_list.html#aa644a8beebf2d26615a11e81b7bd0cc4a0de0f0776ba9d497433f2530e589a178">SymbolList::kToArray</a> ),
<a name="l00214"></a>00214                                                     <a class="code" href="classmocha_1_1_token.html#ad91b4584085a00e1cfe54b275a2c466aa31d9591b4608e04caeb5f7642045700a">Token::JS_IDENTIFIER</a> , ast_node-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a6bda7ec5e55d6baa2afc4ab4300caaf1">Line</a>() , <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba70b4c10f3806f4de5c5f67bce258b5cb">ValueNode::kProperty</a> );
<a name="l00215"></a>00215     <span class="keywordflow">if</span> ( tree-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a6ecb0925a6380a375a92451256039d7f">ChildLength</a>() &gt; 0 ) {
<a name="l00216"></a>00216       list-&gt;<a class="code" href="classmocha_1_1_ast_node.html#acada63e4d868960a7fbd972f3d3a0ae4">AddChild</a>( tree-&gt;<a class="code" href="classmocha_1_1_ast_node.html#ad1a001a8c53bf5f73d4e81096f0f41be">LastChild</a>()-&gt;<a class="code" href="classmocha_1_1_ast_node.html#af2a895699bac2012f8b7739bff49c5ec">Clone</a>() );
<a name="l00217"></a>00217     } <span class="keywordflow">else</span> {
<a name="l00218"></a>00218       list-&gt;<a class="code" href="classmocha_1_1_ast_node.html#acada63e4d868960a7fbd972f3d3a0ae4">AddChild</a>( visitor_info-&gt;<a class="code" href="classmocha_1_1_visitor_info.html#a60fd8ce138f8e41d8694c349b741cb64">GetCurrentStmt</a>()-&gt;<a class="code" href="classmocha_1_1_statement.html#ae1802b82da424cefda6c890563ff2e11">GetDsta</a>()-&gt;<a class="code" href="classmocha_1_1_dsta_extracted_expressions.html#afda6e6826138e547c3cb524e33eb16f9">Refs</a>()-&gt;<a class="code" href="classmocha_1_1_ast_node.html#ad1a001a8c53bf5f73d4e81096f0f41be">LastChild</a>()-&gt;<a class="code" href="classmocha_1_1_ast_node.html#af2a895699bac2012f8b7739bff49c5ec">Clone</a>() );
<a name="l00219"></a>00219     }
<a name="l00220"></a>00220     list-&gt;<a class="code" href="classmocha_1_1_ast_node.html#acada63e4d868960a7fbd972f3d3a0ae4">AddChild</a>( arg );
<a name="l00221"></a>00221     <a class="code" href="classmocha_1_1_call_exp.html">CallExp</a>* nrm = <a class="code" href="classmocha_1_1_ast_utils.html#a77bd4f7ca31be505683055685aa1ff77">AstUtils::CreateNormalAccessor</a>( to_array , list );
<a name="l00222"></a>00222     <a class="code" href="classmocha_1_1_call_exp.html">CallExp</a>* std_to_array = <a class="code" href="classmocha_1_1_ast_utils.html#ad4547f1789aba2e0857a51a02312b7ca">AstUtils::CreateRuntimeMod</a>( nrm );
<a name="l00223"></a>00223     std_to_array-&gt;<a class="code" href="classmocha_1_1_call_exp.html#affa33d340ecb3322fb01d601e3bdc660">Rest</a>();
<a name="l00224"></a>00224     exp = std_to_array;
<a name="l00225"></a>00225   } <span class="keywordflow">else</span> {  
<a name="l00226"></a>00226     <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>* accessor_index = <a class="code" href="classmocha_1_1_managed_handle.html#a37d5506197f103b180d88f19f3b7d2b5">ManagedHandle::Retain</a>( <span class="keyword">new</span> <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>( <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba5452da740cc307738989031c4aca14f9">ValueNode::kNumeric</a> ) );
<a name="l00227"></a>00227     accessor_index-&gt;<a class="code" href="classmocha_1_1_value_node.html#a769c0c221283cca863964f6cf673c170">Symbol</a>( info );
<a name="l00228"></a>00228     <span class="keywordflow">if</span> ( tree-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a6ecb0925a6380a375a92451256039d7f">ChildLength</a>() &gt; 0 ) {
<a name="l00229"></a>00229       exp = <a class="code" href="classmocha_1_1_ast_utils.html#a73682172af76ec16a106911d7546180f">AstUtils::CreateArrayAccessor</a>( tree-&gt;<a class="code" href="classmocha_1_1_ast_node.html#ad1a001a8c53bf5f73d4e81096f0f41be">LastChild</a>() , accessor_index );
<a name="l00230"></a>00230     } <span class="keywordflow">else</span> {
<a name="l00231"></a>00231       exp = <a class="code" href="classmocha_1_1_ast_utils.html#a73682172af76ec16a106911d7546180f">AstUtils::CreateArrayAccessor</a>( visitor_info-&gt;<a class="code" href="classmocha_1_1_visitor_info.html#a60fd8ce138f8e41d8694c349b741cb64">GetCurrentStmt</a>()-&gt;<a class="code" href="classmocha_1_1_statement.html#ae1802b82da424cefda6c890563ff2e11">GetDsta</a>()-&gt;<a class="code" href="classmocha_1_1_dsta_extracted_expressions.html#afda6e6826138e547c3cb524e33eb16f9">Refs</a>()-&gt;<a class="code" href="classmocha_1_1_ast_node.html#ad1a001a8c53bf5f73d4e81096f0f41be">LastChild</a>() , accessor_index );
<a name="l00232"></a>00232     }
<a name="l00233"></a>00233   }
<a name="l00234"></a>00234   <span class="keywordflow">if</span> ( symbol ) {
<a name="l00235"></a>00235     symbol-&gt;<a class="code" href="classmocha_1_1_value_node.html#ae400f4a35352d1052dffc60290c290a0">ValueType</a>( <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba9076c94a3f40287b5942daca9d41b711">ValueNode::kIdentifier</a> );
<a name="l00236"></a>00236     tree-&gt;<a class="code" href="classmocha_1_1_dsta_tree.html#a6ef49ba20cdae2f5885f859e6ea7c9c1">Symbol</a>( symbol );
<a name="l00237"></a>00237   }
<a name="l00238"></a>00238   tree-&gt;<a class="code" href="classmocha_1_1_ast_node.html#acada63e4d868960a7fbd972f3d3a0ae4">AddChild</a>( exp );
<a name="l00239"></a>00239 }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 
<a name="l00245"></a><a class="code" href="namespacemocha.html#af8a6e0cfa8b0cf7abe9b684eec0cfcef">00245</a> <a class="code" href="classmocha_1_1_dsta_tree.html">DstaTree</a>* <a class="code" href="namespacemocha.html#af8a6e0cfa8b0cf7abe9b684eec0cfcef" title="Process each member of array pattern.">ProcessArrayElement</a>( <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>* ast_node,
<a name="l00246"></a>00246                                <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a>* element,
<a name="l00247"></a>00247                                <a class="code" href="classmocha_1_1_dsta_tree.html">DstaTree</a>* tree,
<a name="l00248"></a>00248                                <span class="keywordtype">int</span> depth,
<a name="l00249"></a>00249                                <span class="keywordtype">int</span> index,
<a name="l00250"></a>00250                                <a class="code" href="classmocha_1_1_processor_info.html">ProcessorInfo</a>* info ) {
<a name="l00251"></a>00251   printf( <span class="stringliteral">&quot;depth is = %d\n&quot;</span> , depth );
<a name="l00252"></a>00252   <a class="code" href="classmocha_1_1_visitor_info.html">VisitorInfo</a>* visitor_info = info-&gt;<a class="code" href="classmocha_1_1_processor_info.html#ab6c1f1d981b047d0d4967da546402905">GetInfo</a>();
<a name="l00253"></a>00253   <span class="keywordflow">if</span> ( !element-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a31dd8fcdbeb4b1a6aae660a64a1aac99">IsEmpty</a>() ) {
<a name="l00254"></a>00254     <span class="keywordflow">if</span> ( element-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a930b6f930cbe0efddfde28ec73c200bc">NodeType</a>() == <a class="code" href="classmocha_1_1_ast_node.html#a7e049e71bcf600466f1c977205d8215ba8c24bef501c2e740aa2f6c86a6d040b9">AstNode::kValueNode</a> ) {
<a name="l00255"></a>00255       <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>* elem = element-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a21324d298123937056c972179d03fade">CastToValue</a>();
<a name="l00256"></a>00256       <span class="keywordflow">switch</span>( elem-&gt;<a class="code" href="classmocha_1_1_value_node.html#ae400f4a35352d1052dffc60290c290a0">ValueType</a>() ) {
<a name="l00257"></a>00257         <span class="comment">//In case of [ x , y ]</span>
<a name="l00258"></a>00258         <span class="keywordflow">case</span> <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba9076c94a3f40287b5942daca9d41b711">ValueNode::kIdentifier</a> : <span class="comment">//fall through</span>
<a name="l00259"></a>00259         <span class="keywordflow">case</span> <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba70b4c10f3806f4de5c5f67bce258b5cb">ValueNode::kProperty</a> : {
<a name="l00260"></a>00260           <a class="code" href="namespacemocha.html#a1e0321e63212cb250b296eb1958fde95">ArrayHelper</a>( ast_node , visitor_info , tree , index , elem , <span class="keyword">false</span> );
<a name="l00261"></a>00261           visitor_info-&gt;<a class="code" href="classmocha_1_1_visitor_info.html#a60fd8ce138f8e41d8694c349b741cb64">GetCurrentStmt</a>()-&gt;<a class="code" href="classmocha_1_1_statement.html#ae1802b82da424cefda6c890563ff2e11">GetDsta</a>()-&gt;<a class="code" href="classmocha_1_1_ast_node.html#ad1a001a8c53bf5f73d4e81096f0f41be">LastChild</a>()-&gt;<a class="code" href="classmocha_1_1_ast_node.html#acada63e4d868960a7fbd972f3d3a0ae4">AddChild</a>( tree );
<a name="l00262"></a>00262           <a class="code" href="dsta__processor_8cc.html#a19ff393b4360cbfec2b96ba18961fdb7" title="We express destructuring assingment as dsta.">UPDATE_TREE</a>;
<a name="l00263"></a>00263         }
<a name="l00264"></a>00264           <span class="keywordflow">break</span>;
<a name="l00265"></a>00265           <span class="comment">//In case of [ {x,y} ]</span>
<a name="l00266"></a>00266         <span class="keywordflow">case</span> <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba839c61798b67a9f67787b8cd6c401a65">ValueNode::kObject</a> :
<a name="l00267"></a>00267         <span class="keywordflow">case</span> <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba7dd7e98941f05c893b04c6aed9e00fb1">ValueNode::kDst</a> : {
<a name="l00268"></a>00268           <a class="code" href="namespacemocha.html#a1e0321e63212cb250b296eb1958fde95">ArrayHelper</a>( ast_node , visitor_info , tree , index , 0 , <span class="keyword">false</span> );
<a name="l00269"></a>00269           <a class="code" href="namespacemocha.html#a52d7a3f3bf8de146d1e05760aa7463dc" title="Iterate Object pattern like var { x, y , z : { x } } = {...}.">ProcessObject</a>( elem , tree , ( depth + 1 ) , info );
<a name="l00270"></a>00270           <a class="code" href="dsta__processor_8cc.html#a19ff393b4360cbfec2b96ba18961fdb7" title="We express destructuring assingment as dsta.">UPDATE_TREE</a>;
<a name="l00271"></a>00271         }
<a name="l00272"></a>00272           <span class="keywordflow">break</span>;
<a name="l00273"></a>00273           <span class="comment">//In case of [ [x,y] ]</span>
<a name="l00274"></a>00274         <span class="keywordflow">case</span> <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba95cda68e2b88f59d7c6d539246d5ea77">ValueNode::kArray</a> :
<a name="l00275"></a>00275         <span class="keywordflow">case</span> <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba0a1b856b8d8208cd083c671371e62711">ValueNode::kDstArray</a> : {
<a name="l00276"></a>00276           <a class="code" href="namespacemocha.html#a1e0321e63212cb250b296eb1958fde95">ArrayHelper</a>( ast_node , visitor_info , tree , index , 0 , <span class="keyword">false</span> );
<a name="l00277"></a>00277           <a class="code" href="namespacemocha.html#ae7216e54bbad37a8eb20cdf819e3cc0b" title="Process Array pattern.">ProcessArray</a>( elem , tree , ( depth + 1 ) , info );
<a name="l00278"></a>00278           <a class="code" href="dsta__processor_8cc.html#a19ff393b4360cbfec2b96ba18961fdb7" title="We express destructuring assingment as dsta.">UPDATE_TREE</a>;
<a name="l00279"></a>00279         }
<a name="l00280"></a>00280           <span class="keywordflow">break</span>;
<a name="l00281"></a>00281           <span class="comment">//In case of [ x ,y ,...rest ]</span>
<a name="l00282"></a>00282         <span class="keywordflow">case</span> <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1baa8faa7516fab604f5ac7d591dd383a14">ValueNode::kRest</a> : {
<a name="l00283"></a>00283           fprintf( stderr , <span class="stringliteral">&quot;@@@@@@@@ rest @@@@@@@@@\n&quot;</span>);
<a name="l00284"></a>00284           <a class="code" href="namespacemocha.html#a1e0321e63212cb250b296eb1958fde95">ArrayHelper</a>( ast_node , visitor_info , tree , index , elem , <span class="keyword">true</span> );
<a name="l00285"></a>00285           visitor_info-&gt;<a class="code" href="classmocha_1_1_visitor_info.html#a60fd8ce138f8e41d8694c349b741cb64">GetCurrentStmt</a>()-&gt;<a class="code" href="classmocha_1_1_statement.html#ae1802b82da424cefda6c890563ff2e11">GetDsta</a>()-&gt;<a class="code" href="classmocha_1_1_ast_node.html#ad1a001a8c53bf5f73d4e81096f0f41be">LastChild</a>()-&gt;<a class="code" href="classmocha_1_1_ast_node.html#acada63e4d868960a7fbd972f3d3a0ae4">AddChild</a>( tree );
<a name="l00286"></a>00286           <a class="code" href="dsta__processor_8cc.html#a19ff393b4360cbfec2b96ba18961fdb7" title="We express destructuring assingment as dsta.">UPDATE_TREE</a>;
<a name="l00287"></a>00287         }
<a name="l00288"></a>00288           <span class="keywordflow">break</span>;
<a name="l00289"></a>00289       }
<a name="l00290"></a>00290     }
<a name="l00291"></a>00291   }
<a name="l00292"></a>00292   <span class="keywordflow">return</span> tree;
<a name="l00293"></a>00293 }
<a name="l00294"></a>00294 
<a name="l00295"></a>00295 
<a name="l00304"></a><a class="code" href="namespacemocha.html#ae7216e54bbad37a8eb20cdf819e3cc0b">00304</a> <span class="keywordtype">void</span> <a class="code" href="namespacemocha.html#ae7216e54bbad37a8eb20cdf819e3cc0b" title="Process Array pattern.">ProcessArray</a>( <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>* ast_node , <a class="code" href="classmocha_1_1_dsta_tree.html">DstaTree</a>* tree , <span class="keywordtype">int</span> depth , <a class="code" href="classmocha_1_1_processor_info.html">ProcessorInfo</a>* info ) {
<a name="l00305"></a>00305   <a class="code" href="classmocha_1_1_node_iterator.html">NodeIterator</a> list_child = ast_node-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a3c769907079ab97a2970d6b54d137ab0">ChildNodes</a>();
<a name="l00306"></a>00306   <span class="keywordtype">int</span> index = 0;
<a name="l00307"></a>00307   <span class="keywordflow">while</span> ( list_child.<a class="code" href="classmocha_1_1_node_iterator.html#ae3ce9ed39cc570c83549498c121c0150">HasNext</a>() ) {
<a name="l00308"></a>00308     <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a>* item = list_child.<a class="code" href="classmocha_1_1_node_iterator.html#acc2e3f06c89bb07d2d64f2c024900d5b">Next</a>();
<a name="l00309"></a>00309     <span class="keywordflow">if</span> ( !item-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a31dd8fcdbeb4b1a6aae660a64a1aac99">IsEmpty</a>() ) {
<a name="l00310"></a>00310       <a class="code" href="classmocha_1_1_node_iterator.html">NodeIterator</a> iter = item-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a3c769907079ab97a2970d6b54d137ab0">ChildNodes</a>();
<a name="l00311"></a>00311       <span class="keywordflow">while</span> ( iter.<a class="code" href="classmocha_1_1_node_iterator.html#ae3ce9ed39cc570c83549498c121c0150">HasNext</a>() ) {
<a name="l00312"></a>00312         <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a>* element = iter.<a class="code" href="classmocha_1_1_node_iterator.html#acc2e3f06c89bb07d2d64f2c024900d5b">Next</a>();
<a name="l00313"></a>00313         tree = <a class="code" href="namespacemocha.html#af8a6e0cfa8b0cf7abe9b684eec0cfcef" title="Process each member of array pattern.">ProcessArrayElement</a>( ast_node , element , tree , depth , index , info );
<a name="l00314"></a>00314         <span class="keywordflow">if</span> ( iter.<a class="code" href="classmocha_1_1_node_iterator.html#ae3ce9ed39cc570c83549498c121c0150">HasNext</a>() ) {
<a name="l00315"></a>00315           index++;
<a name="l00316"></a>00316         }
<a name="l00317"></a>00317       }
<a name="l00318"></a>00318     }
<a name="l00319"></a>00319   }
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322 
<a name="l00323"></a>00323 <span class="comment">//Create a conditional expression that dsta converted result.</span>
<a name="l00324"></a><a class="code" href="namespacemocha.html#a112c49bb7f4b348cfb03ece35ee1c97a">00324</a> <span class="keyword">inline</span> <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a>* <a class="code" href="namespacemocha.html#a112c49bb7f4b348cfb03ece35ee1c97a">CreateConditional</a>( <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a>* last_exp , <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a>* first , <a class="code" href="classmocha_1_1_processor_info.html">ProcessorInfo</a> *info , <span class="keywordtype">bool</span> is_assign ) {
<a name="l00325"></a>00325   <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>* undefined = <a class="code" href="classmocha_1_1_ast_utils.html#a1a4ad629469bdb21a0b4b67023c416f1">AstUtils::CreateNameNode</a>( <a class="code" href="classmocha_1_1_symbol_list.html#ae1c6ed56e340562976099133b2c258d0">SymbolList::GetSymbol</a>( <a class="code" href="classmocha_1_1_symbol_list.html#ae6106c4f71f0e9abecd8f3f9f5500d66acd88abdc7a362830fc98bcdcf74de223">SymbolList::kUndefined</a> ),
<a name="l00326"></a>00326                                                    <a class="code" href="classmocha_1_1_token.html#ad91b4584085a00e1cfe54b275a2c466aa31d9591b4608e04caeb5f7642045700a">Token::JS_IDENTIFIER</a> , last_exp-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a6bda7ec5e55d6baa2afc4ab4300caaf1">Line</a>() , <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba9076c94a3f40287b5942daca9d41b711">ValueNode::kIdentifier</a> );
<a name="l00327"></a>00327   <a class="code" href="classmocha_1_1_conditional_exp.html">ConditionalExp</a>* cond = <a class="code" href="classmocha_1_1_managed_handle.html#a37d5506197f103b180d88f19f3b7d2b5">ManagedHandle::Retain</a>( <span class="keyword">new</span> <a class="code" href="classmocha_1_1_conditional_exp.html">ConditionalExp</a>( last_exp , first-&gt;<a class="code" href="classmocha_1_1_ast_node.html#ad1a001a8c53bf5f73d4e81096f0f41be">LastChild</a>() , undefined ) );
<a name="l00328"></a>00328   <a class="code" href="classmocha_1_1_dsta_tree.html">DstaTree</a>* tree = 0;<span class="comment">//init after.</span>
<a name="l00329"></a>00329   <span class="keywordflow">if</span> ( first-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a930b6f930cbe0efddfde28ec73c200bc">NodeType</a>() == <a class="code" href="classmocha_1_1_ast_node.html#a7e049e71bcf600466f1c977205d8215ba4b5635e5736b2bd7d3ec324b1ec7b888">AstNode::kDstaTree</a> ) {
<a name="l00330"></a>00330     tree = first-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a29ea81ee14ae435fc24dcbf25a617580">CastToDstaTree</a>();
<a name="l00331"></a>00331   } <span class="keywordflow">else</span> {
<a name="l00332"></a>00332     <a class="code" href="dsta__processor_8cc.html#a04742d7f90e8442694c6966153e818a2">ERROR</a>( info , <a class="code" href="namespacemocha.html#a112c49bb7f4b348cfb03ece35ee1c97a">CreateConditional</a> );
<a name="l00333"></a>00333     <span class="keywordflow">return</span> 0;
<a name="l00334"></a>00334   }
<a name="l00335"></a>00335   <span class="keywordflow">if</span> ( !is_assign ) {
<a name="l00336"></a>00336     <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>* var = <a class="code" href="classmocha_1_1_managed_handle.html#a37d5506197f103b180d88f19f3b7d2b5">ManagedHandle::Retain</a>( <span class="keyword">new</span> <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>( <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1babcec8f8a2acd9a985dbd67c79f2ad9d5">ValueNode::kVariable</a> ) );
<a name="l00337"></a>00337     var-&gt;<a class="code" href="classmocha_1_1_value_node.html#a769c0c221283cca863964f6cf673c170">Symbol</a>( tree-&gt;<a class="code" href="classmocha_1_1_dsta_tree.html#a6ef49ba20cdae2f5885f859e6ea7c9c1">Symbol</a>()-&gt;Symbol() );
<a name="l00338"></a>00338     var-&gt;<a class="code" href="classmocha_1_1_ast_node.html#acada63e4d868960a7fbd972f3d3a0ae4">AddChild</a>( cond );
<a name="l00339"></a>00339     <a class="code" href="classmocha_1_1_function.html">Function</a>* fn = info-&gt;<a class="code" href="classmocha_1_1_processor_info.html#ab6c1f1d981b047d0d4967da546402905">GetInfo</a>()-&gt;<a class="code" href="classmocha_1_1_visitor_info.html#a4512eccf2f755a6875f3088398ab3408">GetFunction</a>();
<a name="l00340"></a>00340     <span class="keywordflow">if</span> ( fn ) {
<a name="l00341"></a>00341       fn-&gt;<a class="code" href="classmocha_1_1_function.html#a9044326e0ef52a277c7131d986158ed9">SetVariable</a>( var );
<a name="l00342"></a>00342     }
<a name="l00343"></a>00343     <span class="keywordflow">return</span> var;
<a name="l00344"></a>00344   } <span class="keywordflow">else</span> {
<a name="l00345"></a>00345     <a class="code" href="classmocha_1_1_assignment_exp.html">AssignmentExp</a>* assign = <a class="code" href="classmocha_1_1_managed_handle.html#a37d5506197f103b180d88f19f3b7d2b5">ManagedHandle::Retain</a>( <span class="keyword">new</span> <a class="code" href="classmocha_1_1_assignment_exp.html">AssignmentExp</a>( <span class="charliteral">&#39;=&#39;</span> , tree-&gt;<a class="code" href="classmocha_1_1_dsta_tree.html#a6ef49ba20cdae2f5885f859e6ea7c9c1">Symbol</a>()-&gt;Clone() , cond ) );
<a name="l00346"></a>00346     <span class="keywordflow">return</span> assign;
<a name="l00347"></a>00347   }
<a name="l00348"></a>00348 }
<a name="l00349"></a>00349 
<a name="l00350"></a>00350 
<a name="l00351"></a>00351 
<a name="l00352"></a><a class="code" href="namespacemocha.html#a7f88242dd7a314683af9e25a253575ec">00352</a> <a class="code" href="classmocha_1_1_node_list.html">NodeList</a>* <a class="code" href="namespacemocha.html#a7f88242dd7a314683af9e25a253575ec">IterateTree</a>( <a class="code" href="classmocha_1_1_node_list.html">NodeList</a>* result,
<a name="l00353"></a>00353                        <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a>* first,
<a name="l00354"></a>00354                        <a class="code" href="classmocha_1_1_processor_info.html">ProcessorInfo</a> *info,
<a name="l00355"></a>00355                        <span class="keywordtype">bool</span> is_assign ) {
<a name="l00356"></a>00356   <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a>* maybe_callexp = 0;<span class="comment">//init after.</span>
<a name="l00357"></a>00357   <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a>* last_exp = 0;<span class="comment">//init after.</span>
<a name="l00358"></a>00358   <span class="comment">//The Children of tree.</span>
<a name="l00359"></a>00359   <a class="code" href="classmocha_1_1_node_iterator.html">NodeIterator</a> exps = first-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a3c769907079ab97a2970d6b54d137ab0">ChildNodes</a>();
<a name="l00366"></a>00366   <span class="keywordflow">while</span> ( exps.<a class="code" href="classmocha_1_1_node_iterator.html#ae3ce9ed39cc570c83549498c121c0150">HasNext</a>() ) {
<a name="l00367"></a>00367     maybe_callexp = exps.<a class="code" href="classmocha_1_1_node_iterator.html#acc2e3f06c89bb07d2d64f2c024900d5b">Next</a>();
<a name="l00368"></a>00368     <a class="code" href="classmocha_1_1_call_exp.html">CallExp</a>* item = 0;<span class="comment">//init after.</span>
<a name="l00369"></a>00369     <span class="keywordflow">if</span> ( maybe_callexp-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a930b6f930cbe0efddfde28ec73c200bc">NodeType</a>() == <a class="code" href="classmocha_1_1_ast_node.html#a7e049e71bcf600466f1c977205d8215bab506f335673bc6a1d55af567e7689abd">AstNode::kCallExp</a> ) {
<a name="l00370"></a>00370       item = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classmocha_1_1_call_exp.html">CallExp</a>*<span class="keyword">&gt;</span>( maybe_callexp );
<a name="l00371"></a>00371     } <span class="keywordflow">else</span> {
<a name="l00372"></a>00372       <a class="code" href="dsta__processor_8cc.html#a04742d7f90e8442694c6966153e818a2">ERROR</a>( info , <span class="stringliteral">&quot;CreateDstaExtractedVarStmt&quot;</span> );
<a name="l00373"></a>00373       <span class="keywordflow">return</span> 0;
<a name="l00374"></a>00374     }
<a name="l00375"></a>00375     <span class="comment">//Only first time.</span>
<a name="l00376"></a>00376     <span class="keywordflow">if</span> ( !last_exp ) {
<a name="l00377"></a>00377       maybe_callexp = exps.<a class="code" href="classmocha_1_1_node_iterator.html#acc2e3f06c89bb07d2d64f2c024900d5b">Next</a>();
<a name="l00378"></a>00378       <a class="code" href="classmocha_1_1_call_exp.html">CallExp</a>* next = 0;<span class="comment">//init after.</span>
<a name="l00379"></a>00379       <span class="keywordflow">if</span> ( maybe_callexp-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a930b6f930cbe0efddfde28ec73c200bc">NodeType</a>() == <a class="code" href="classmocha_1_1_ast_node.html#a7e049e71bcf600466f1c977205d8215bab506f335673bc6a1d55af567e7689abd">AstNode::kCallExp</a> ) {
<a name="l00380"></a>00380         next = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classmocha_1_1_call_exp.html">CallExp</a>*<span class="keyword">&gt;</span>( maybe_callexp );
<a name="l00381"></a>00381       } <span class="keywordflow">else</span> {
<a name="l00382"></a>00382         <a class="code" href="dsta__processor_8cc.html#a04742d7f90e8442694c6966153e818a2">ERROR</a>( info , <span class="stringliteral">&quot;CreateDstaExtractedVarStmt&quot;</span> );
<a name="l00383"></a>00383         <span class="keywordflow">return</span> 0;
<a name="l00384"></a>00384       }
<a name="l00385"></a>00385       <span class="keywordflow">if</span> ( !next-&gt;<a class="code" href="classmocha_1_1_call_exp.html#aa85eec3d1b9f2422f3566905189a1036">IsRest</a>() ) {
<a name="l00386"></a>00386         <span class="comment">//Create and exparession. like -&gt; a &amp;&amp; b</span>
<a name="l00387"></a>00387         last_exp = <a class="code" href="classmocha_1_1_managed_handle.html#a37d5506197f103b180d88f19f3b7d2b5">ManagedHandle::Retain</a>( <span class="keyword">new</span> <a class="code" href="classmocha_1_1_compare_exp.html">CompareExp</a>( <a class="code" href="classmocha_1_1_token.html#ad91b4584085a00e1cfe54b275a2c466aa2ba130f16b934a2e4a9223e7999deb5a">Token::JS_LOGICAL_AND</a> , item , next ) );
<a name="l00388"></a>00388       } <span class="keywordflow">else</span> {
<a name="l00389"></a>00389         <span class="comment">/*</span>
<a name="l00390"></a>00390 <span class="comment">         * In case of rest,</span>
<a name="l00391"></a>00391 <span class="comment">         * we don&#39;t set an item to logical_and_expression.</span>
<a name="l00392"></a>00392 <span class="comment">         */</span>
<a name="l00393"></a>00393         last_exp = item;
<a name="l00394"></a>00394       }
<a name="l00395"></a>00395     } <span class="keywordflow">else</span> {
<a name="l00396"></a>00396       <span class="keywordflow">if</span> ( !item-&gt;<a class="code" href="classmocha_1_1_call_exp.html#aa85eec3d1b9f2422f3566905189a1036">IsRest</a>() ) {
<a name="l00397"></a>00397         last_exp = <a class="code" href="classmocha_1_1_managed_handle.html#a37d5506197f103b180d88f19f3b7d2b5">ManagedHandle::Retain</a>( <span class="keyword">new</span> <a class="code" href="classmocha_1_1_compare_exp.html">CompareExp</a>( <a class="code" href="classmocha_1_1_token.html#ad91b4584085a00e1cfe54b275a2c466aa2ba130f16b934a2e4a9223e7999deb5a">Token::JS_LOGICAL_AND</a> , last_exp , item ) );
<a name="l00398"></a>00398       }
<a name="l00399"></a>00399     }
<a name="l00400"></a>00400   }
<a name="l00401"></a>00401   <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a>* ret = <a class="code" href="namespacemocha.html#a112c49bb7f4b348cfb03ece35ee1c97a">CreateConditional</a>( last_exp , first , info , is_assign );
<a name="l00402"></a>00402   <span class="keywordflow">if</span> ( !ret ) {
<a name="l00403"></a>00403     <span class="keywordflow">return</span> 0;
<a name="l00404"></a>00404   }
<a name="l00405"></a>00405   result-&gt;<a class="code" href="classmocha_1_1_ast_node.html#acada63e4d868960a7fbd972f3d3a0ae4">AddChild</a>( ret );
<a name="l00406"></a>00406   <span class="keywordflow">return</span> result;
<a name="l00407"></a>00407 }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409 
<a name="l00410"></a>00410 
<a name="l00419"></a><a class="code" href="namespacemocha.html#aa1c1e8405ca6a36492f0ae4b6f6f5a88">00419</a> <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a>* <a class="code" href="namespacemocha.html#aa1c1e8405ca6a36492f0ae4b6f6f5a88" title="Simple property accessor.">CreateSimpleAccessor</a>( <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a>* first , <a class="code" href="classmocha_1_1_visitor_info.html">VisitorInfo</a>* info , <span class="keywordtype">bool</span> is_assign ) {
<a name="l00420"></a>00420   <span class="keywordflow">if</span> ( !is_assign ) {
<a name="l00421"></a>00421     <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>* var = <a class="code" href="classmocha_1_1_managed_handle.html#a37d5506197f103b180d88f19f3b7d2b5">ManagedHandle::Retain</a>( <span class="keyword">new</span> <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>( <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1babcec8f8a2acd9a985dbd67c79f2ad9d5">ValueNode::kVariable</a> ) );
<a name="l00422"></a>00422     <a class="code" href="classmocha_1_1_dsta_tree.html">DstaTree</a>* tree = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classmocha_1_1_dsta_tree.html">DstaTree</a>*<span class="keyword">&gt;</span>( first );
<a name="l00423"></a>00423     var-&gt;<a class="code" href="classmocha_1_1_value_node.html#a769c0c221283cca863964f6cf673c170">Symbol</a>( tree-&gt;<a class="code" href="classmocha_1_1_dsta_tree.html#a6ef49ba20cdae2f5885f859e6ea7c9c1">Symbol</a>()-&gt;Symbol() );
<a name="l00424"></a>00424     <a class="code" href="classmocha_1_1_function.html">Function</a>* fn = info-&gt;<a class="code" href="classmocha_1_1_visitor_info.html#a4512eccf2f755a6875f3088398ab3408">GetFunction</a>();
<a name="l00425"></a>00425     <span class="keywordflow">if</span> ( fn ) {
<a name="l00426"></a>00426       fn-&gt;<a class="code" href="classmocha_1_1_function.html#a9044326e0ef52a277c7131d986158ed9">SetVariable</a>( var );
<a name="l00427"></a>00427     }
<a name="l00428"></a>00428     var-&gt;<a class="code" href="classmocha_1_1_ast_node.html#acada63e4d868960a7fbd972f3d3a0ae4">AddChild</a>( first-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a65c6f1546ebb657cbfb265f372c183cd">FirstChild</a>() );
<a name="l00429"></a>00429     <span class="keywordflow">return</span> var;
<a name="l00430"></a>00430   } <span class="keywordflow">else</span> {
<a name="l00431"></a>00431     <a class="code" href="classmocha_1_1_dsta_tree.html">DstaTree</a>* tree = first-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a29ea81ee14ae435fc24dcbf25a617580">CastToDstaTree</a>();
<a name="l00432"></a>00432     <a class="code" href="classmocha_1_1_assignment_exp.html">AssignmentExp</a>* assign = <a class="code" href="classmocha_1_1_managed_handle.html#a37d5506197f103b180d88f19f3b7d2b5">ManagedHandle::Retain</a>( <span class="keyword">new</span> <a class="code" href="classmocha_1_1_assignment_exp.html">AssignmentExp</a>( <span class="charliteral">&#39;=&#39;</span> , tree-&gt;<a class="code" href="classmocha_1_1_dsta_tree.html#a6ef49ba20cdae2f5885f859e6ea7c9c1">Symbol</a>()-&gt;Clone() , first-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a65c6f1546ebb657cbfb265f372c183cd">FirstChild</a>() ) );
<a name="l00433"></a>00433     <span class="keywordflow">return</span> assign;
<a name="l00434"></a>00434   }
<a name="l00435"></a>00435 }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437 
<a name="l00438"></a>00438 
<a name="l00443"></a><a class="code" href="namespacemocha.html#acd5c53aedeb5b13ad796ff32a95e6ac3">00443</a> <a class="code" href="classmocha_1_1_node_list.html">NodeList</a>* <a class="code" href="namespacemocha.html#acd5c53aedeb5b13ad796ff32a95e6ac3" title="Create a statement, from the results of analyzing dsta expressions.">CreateDstaExtractedNode</a>( <a class="code" href="classmocha_1_1_statement.html">Statement</a>* stmt , <a class="code" href="classmocha_1_1_processor_info.html">ProcessorInfo</a>* info , <span class="keywordtype">bool</span> is_assign ) {
<a name="l00444"></a>00444   <a class="code" href="classmocha_1_1_node_list.html">NodeList</a>* result = ManagedHandle::Retain&lt;NodeList&gt;();
<a name="l00445"></a>00445   <a class="code" href="classmocha_1_1_dsta_extracted_expressions.html">DstaExtractedExpressions</a>* extr = stmt-&gt;<a class="code" href="classmocha_1_1_statement.html#ae1802b82da424cefda6c890563ff2e11">GetDsta</a>();
<a name="l00446"></a>00446   <span class="keywordflow">if</span> ( extr == 0 ) {
<a name="l00447"></a>00447     <a class="code" href="dsta__processor_8cc.html#a04742d7f90e8442694c6966153e818a2">ERROR</a>( info , <span class="stringliteral">&quot;CreateDstaExtractedVarStmt&quot;</span> );
<a name="l00448"></a>00448     <span class="keywordflow">return</span> 0;
<a name="l00449"></a>00449   }
<a name="l00450"></a>00450   <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a>* node_list = extr-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a65c6f1546ebb657cbfb265f372c183cd">FirstChild</a>();
<a name="l00451"></a>00451   <a class="code" href="classmocha_1_1_node_iterator.html">NodeIterator</a> list = node_list-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a3c769907079ab97a2970d6b54d137ab0">ChildNodes</a>();
<a name="l00460"></a>00460   <span class="keywordflow">while</span> ( list.<a class="code" href="classmocha_1_1_node_iterator.html#ae3ce9ed39cc570c83549498c121c0150">HasNext</a>() ) {
<a name="l00461"></a>00461     <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a> *first = list.<a class="code" href="classmocha_1_1_node_iterator.html#acc2e3f06c89bb07d2d64f2c024900d5b">Next</a>();
<a name="l00462"></a>00462     fprintf( stderr, <span class="stringliteral">&quot;|||||||||||||||||type = %s , %s\n&quot;</span> , first-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a9ba8e34d2b96cfe1caa097ae620fca6e">GetName</a>() , first-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a29ea81ee14ae435fc24dcbf25a617580">CastToDstaTree</a>()-&gt;<a class="code" href="classmocha_1_1_dsta_tree.html#a6ef49ba20cdae2f5885f859e6ea7c9c1">Symbol</a>()-&gt;Symbol()-&gt;GetToken() );
<a name="l00463"></a>00463     <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a>* maybe_callexp = first-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a65c6f1546ebb657cbfb265f372c183cd">FirstChild</a>();
<a name="l00464"></a>00464     <a class="code" href="classmocha_1_1_call_exp.html">CallExp</a>* exp = 0;<span class="comment">//init after.</span>
<a name="l00465"></a>00465     <span class="keywordflow">if</span> ( maybe_callexp != 0 &amp;&amp; maybe_callexp-&gt;NodeType() == <a class="code" href="classmocha_1_1_ast_node.html#a7e049e71bcf600466f1c977205d8215bab506f335673bc6a1d55af567e7689abd">AstNode::kCallExp</a> ) {
<a name="l00466"></a>00466       exp = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classmocha_1_1_call_exp.html">CallExp</a>*<span class="keyword">&gt;</span>( first-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a65c6f1546ebb657cbfb265f372c183cd">FirstChild</a>() );
<a name="l00467"></a>00467     } <span class="keywordflow">else</span> {
<a name="l00468"></a>00468       <a class="code" href="dsta__processor_8cc.html#a04742d7f90e8442694c6966153e818a2">ERROR</a>( info , <span class="stringliteral">&quot;CreateDstaExtractedVarStmt&quot;</span> );
<a name="l00469"></a>00469       <span class="keywordflow">return</span> 0;
<a name="l00470"></a>00470     }
<a name="l00471"></a>00471     <span class="keywordflow">if</span> ( first-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a6ecb0925a6380a375a92451256039d7f">ChildLength</a>() &gt; 1 &amp;&amp; !exp-&gt;<a class="code" href="classmocha_1_1_call_exp.html#aa85eec3d1b9f2422f3566905189a1036">IsRest</a>() ) {
<a name="l00472"></a>00472       <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a>* ret = <a class="code" href="namespacemocha.html#a7f88242dd7a314683af9e25a253575ec">IterateTree</a>( result , first , info , is_assign );
<a name="l00473"></a>00473       <span class="keywordflow">if</span> ( ret == 0 ) {
<a name="l00474"></a>00474         <span class="keywordflow">return</span> 0;
<a name="l00475"></a>00475       }
<a name="l00476"></a>00476     } <span class="keywordflow">else</span> {
<a name="l00477"></a>00477       <a class="code" href="classmocha_1_1_ast_node.html">AstNode</a>* ret = <a class="code" href="namespacemocha.html#aa1c1e8405ca6a36492f0ae4b6f6f5a88" title="Simple property accessor.">CreateSimpleAccessor</a>( first , info-&gt;<a class="code" href="classmocha_1_1_processor_info.html#ab6c1f1d981b047d0d4967da546402905">GetInfo</a>() , is_assign );
<a name="l00478"></a>00478       result-&gt;<a class="code" href="classmocha_1_1_ast_node.html#acada63e4d868960a7fbd972f3d3a0ae4">AddChild</a>( ret );
<a name="l00479"></a>00479     }
<a name="l00480"></a>00480   }
<a name="l00481"></a>00481   <span class="keywordflow">return</span> result;
<a name="l00482"></a>00482 }
<a name="l00483"></a>00483 
<a name="l00484"></a>00484 
<a name="l00485"></a>00485 
<a name="l00490"></a><a class="code" href="classmocha_1_1_dsta_processor.html#a9323e86b8a5d1857db8a1e186ee4fd3f">00490</a> <a class="code" href="classmocha_1_1_node_list.html">NodeList</a>* <a class="code" href="classmocha_1_1_dsta_processor.html#a9323e86b8a5d1857db8a1e186ee4fd3f" title="Create a variable statement, from the results of analyzing dsta expressions.">DstaProcessor::CreateDstaExtractedVarStmt</a>( <a class="code" href="classmocha_1_1_statement.html">Statement</a>* stmt , <a class="code" href="classmocha_1_1_processor_info.html">ProcessorInfo</a>* info ) {
<a name="l00491"></a>00491   <span class="keywordflow">return</span> <a class="code" href="namespacemocha.html#acd5c53aedeb5b13ad796ff32a95e6ac3" title="Create a statement, from the results of analyzing dsta expressions.">CreateDstaExtractedNode</a>( stmt , info , <span class="keyword">false</span> );
<a name="l00492"></a>00492 }
<a name="l00493"></a>00493 
<a name="l00494"></a>00494 
<a name="l00495"></a>00495 
<a name="l00500"></a><a class="code" href="classmocha_1_1_dsta_processor.html#a912f770394af3067ab097df45d9b4d7c">00500</a> <a class="code" href="classmocha_1_1_node_list.html">NodeList</a>* <a class="code" href="classmocha_1_1_dsta_processor.html#a912f770394af3067ab097df45d9b4d7c" title="Create a Assignment expression, from the results of analyzing dsta expressions.">DstaProcessor::CreateDstaExtractedAssignment</a>( <a class="code" href="classmocha_1_1_statement.html">Statement</a>* stmt , <a class="code" href="classmocha_1_1_processor_info.html">ProcessorInfo</a>* info ) {
<a name="l00501"></a>00501   <span class="keywordflow">return</span> <a class="code" href="namespacemocha.html#acd5c53aedeb5b13ad796ff32a95e6ac3" title="Create a statement, from the results of analyzing dsta expressions.">CreateDstaExtractedNode</a>( stmt , info , <span class="keyword">true</span> );
<a name="l00502"></a>00502 }
<a name="l00503"></a>00503 
<a name="l00504"></a>00504 
<a name="l00505"></a>00505 
<a name="l00506"></a><a class="code" href="classmocha_1_1_dsta_processor.html#aa9e05aa90c50ae41867bcd90b72f9127">00506</a> <span class="keywordtype">int</span> <a class="code" href="classmocha_1_1_dsta_processor.html#aa9e05aa90c50ae41867bcd90b72f9127">DstaProcessor::ProcessNode</a>( <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>* ast_node , <a class="code" href="classmocha_1_1_processor_info.html">ProcessorInfo</a>* info ) {
<a name="l00511"></a>00511   <span class="keywordtype">char</span> buf[50];
<a name="l00512"></a>00512   <a class="code" href="classmocha_1_1_visitor_info.html">VisitorInfo</a>* visitor_info = info-&gt;<a class="code" href="classmocha_1_1_processor_info.html#ab6c1f1d981b047d0d4967da546402905">GetInfo</a>();
<a name="l00513"></a>00513   <span class="keyword">const</span> <span class="keywordtype">char</span> *tmp_ref = <a class="code" href="classmocha_1_1_ast_utils.html#a75c091058d5c25382b877015958a8400">AstUtils::CreateTmpRef</a>( buf , visitor_info-&gt;<a class="code" href="classmocha_1_1_visitor_info.html#a0b8fab810d5059ef5d6f09c3e6ef4a78">GetTmpIndex</a>() );
<a name="l00514"></a>00514   <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>* value = <a class="code" href="classmocha_1_1_ast_utils.html#a1a4ad629469bdb21a0b4b67023c416f1">AstUtils::CreateNameNode</a>( tmp_ref , <a class="code" href="classmocha_1_1_token.html#ad91b4584085a00e1cfe54b275a2c466aa31d9591b4608e04caeb5f7642045700a">Token::JS_IDENTIFIER</a> , ast_node-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a6bda7ec5e55d6baa2afc4ab4300caaf1">Line</a>(),
<a name="l00515"></a>00515                                                <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba9076c94a3f40287b5942daca9d41b711">ValueNode::kIdentifier</a> , true );
<a name="l00519"></a>00519   <a class="code" href="classmocha_1_1_dsta_tree.html">DstaTree</a>* tree = ManagedHandle::Retain&lt;DstaTree&gt;();
<a name="l00524"></a>00524   <a class="code" href="classmocha_1_1_statement.html">Statement</a>* stmt = visitor_info-&gt;<a class="code" href="classmocha_1_1_visitor_info.html#a60fd8ce138f8e41d8694c349b741cb64">GetCurrentStmt</a>();
<a name="l00525"></a>00525   <span class="keywordflow">if</span> ( stmt &amp;&amp; !stmt-&gt;HasDsta() ) {
<a name="l00526"></a>00526     visitor_info-&gt;<a class="code" href="classmocha_1_1_visitor_info.html#a60fd8ce138f8e41d8694c349b741cb64">GetCurrentStmt</a>()-&gt;<a class="code" href="classmocha_1_1_statement.html#aff56aa2480452a15ad08f3b70e75ff88">SetDsta</a>( ManagedHandle::Retain&lt;DstaExtractedExpressions&gt;() );
<a name="l00527"></a>00527     visitor_info-&gt;<a class="code" href="classmocha_1_1_visitor_info.html#a60fd8ce138f8e41d8694c349b741cb64">GetCurrentStmt</a>()-&gt;<a class="code" href="classmocha_1_1_statement.html#ae1802b82da424cefda6c890563ff2e11">GetDsta</a>()-&gt;<a class="code" href="classmocha_1_1_ast_node.html#acada63e4d868960a7fbd972f3d3a0ae4">AddChild</a>( ManagedHandle::Retain&lt;NodeList&gt;() );
<a name="l00528"></a>00528   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !stmt ) {
<a name="l00529"></a>00529     <a class="code" href="dsta__processor_8cc.html#a04742d7f90e8442694c6966153e818a2">ERROR</a>( info , <span class="stringliteral">&quot;ProcessNode&quot;</span> );
<a name="l00530"></a>00530     <span class="keywordflow">return</span> <a class="code" href="classmocha_1_1_dsta_processor.html#a0ecba8d2e7294167a260e88c483dce23a5471824fb66c1ace1bee0f9c6ae843ae">kError</a>;
<a name="l00531"></a>00531   }
<a name="l00535"></a>00535   visitor_info-&gt;<a class="code" href="classmocha_1_1_visitor_info.html#a60fd8ce138f8e41d8694c349b741cb64">GetCurrentStmt</a>()-&gt;<a class="code" href="classmocha_1_1_statement.html#ae1802b82da424cefda6c890563ff2e11">GetDsta</a>()-&gt;<a class="code" href="classmocha_1_1_dsta_extracted_expressions.html#afda6e6826138e547c3cb524e33eb16f9">Refs</a>( value );
<a name="l00536"></a>00536   <span class="keywordflow">if</span> ( ast_node-&gt;<a class="code" href="classmocha_1_1_value_node.html#ae400f4a35352d1052dffc60290c290a0">ValueType</a>() == <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba0a1b856b8d8208cd083c671371e62711">ValueNode::kDstArray</a> ||
<a name="l00537"></a>00537        ast_node-&gt;<a class="code" href="classmocha_1_1_value_node.html#ae400f4a35352d1052dffc60290c290a0">ValueType</a>() == <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba95cda68e2b88f59d7c6d539246d5ea77">ValueNode::kArray</a> ) {
<a name="l00538"></a>00538     <a class="code" href="namespacemocha.html#ae7216e54bbad37a8eb20cdf819e3cc0b" title="Process Array pattern.">ProcessArray</a>( ast_node , tree , 0 , info );
<a name="l00539"></a>00539   } <span class="keywordflow">else</span> {
<a name="l00540"></a>00540     <a class="code" href="namespacemocha.html#a52d7a3f3bf8de146d1e05760aa7463dc" title="Iterate Object pattern like var { x, y , z : { x } } = {...}.">ProcessObject</a>( ast_node , tree , 0 , info );
<a name="l00541"></a>00541   }
<a name="l00545"></a>00545   ast_node-&gt;<a class="code" href="classmocha_1_1_value_node.html#ae400f4a35352d1052dffc60290c290a0">ValueType</a>( <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1ba9076c94a3f40287b5942daca9d41b711">ValueNode::kIdentifier</a> );
<a name="l00546"></a>00546   ast_node-&gt;<a class="code" href="classmocha_1_1_value_node.html#a769c0c221283cca863964f6cf673c170">Symbol</a>( value-&gt;Symbol() );
<a name="l00547"></a>00547   
<a name="l00548"></a>00548   <span class="keywordflow">return</span> <a class="code" href="classmocha_1_1_dsta_processor.html#a0ecba8d2e7294167a260e88c483dce23af842955727018749f76b8e706b34effa">kSuccess</a>;
<a name="l00549"></a>00549 }
<a name="l00550"></a>00550 
<a name="l00551"></a>00551 
<a name="l00555"></a><a class="code" href="classmocha_1_1_dsta_processor.html#a78c733b14ee5164d619885b75e0fecd1">00555</a> <a class="code" href="classmocha_1_1_variable_stmt.html">VariableStmt</a>* <a class="code" href="classmocha_1_1_dsta_processor.html#a78c733b14ee5164d619885b75e0fecd1" title="Create temporary referrence variable.">DstaProcessor::CreateTmpVarDecl</a>( <a class="code" href="classmocha_1_1_statement.html">Statement</a>* stmt , <a class="code" href="classmocha_1_1_processor_info.html">ProcessorInfo</a>* info ) {
<a name="l00556"></a>00556   <a class="code" href="classmocha_1_1_dsta_extracted_expressions.html">DstaExtractedExpressions</a>* dsta_extr = stmt-&gt;<a class="code" href="classmocha_1_1_statement.html#ae1802b82da424cefda6c890563ff2e11">GetDsta</a>();
<a name="l00557"></a>00557   
<a name="l00558"></a>00558   <span class="keywordflow">if</span> ( dsta_extr == 0 ) {
<a name="l00559"></a>00559     <a class="code" href="dsta__processor_8cc.html#a04742d7f90e8442694c6966153e818a2">ERROR</a>( info , <span class="stringliteral">&quot;CreateTmpVarDecl&quot;</span> );
<a name="l00560"></a>00560     <span class="keywordflow">return</span> 0;
<a name="l00561"></a>00561   }
<a name="l00562"></a>00562   
<a name="l00563"></a>00563   <a class="code" href="classmocha_1_1_node_list.html">NodeList</a>* list = dsta_extr-&gt;<a class="code" href="classmocha_1_1_dsta_extracted_expressions.html#afda6e6826138e547c3cb524e33eb16f9">Refs</a>();
<a name="l00564"></a>00564   <a class="code" href="classmocha_1_1_node_iterator.html">NodeIterator</a> iterator = list-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a3c769907079ab97a2970d6b54d137ab0">ChildNodes</a>();
<a name="l00565"></a>00565   <a class="code" href="classmocha_1_1_node_list.html">NodeList</a>* var_list = ManagedHandle::Retain&lt;NodeList&gt;();
<a name="l00566"></a>00566 
<a name="l00570"></a>00570   <span class="keywordflow">while</span> ( iterator.<a class="code" href="classmocha_1_1_node_iterator.html#ae3ce9ed39cc570c83549498c121c0150">HasNext</a>() ) {
<a name="l00571"></a>00571     <a class="code" href="classmocha_1_1_value_node.html">ValueNode</a>* value = iterator.<a class="code" href="classmocha_1_1_node_iterator.html#acc2e3f06c89bb07d2d64f2c024900d5b">Next</a>()-&gt;<a class="code" href="classmocha_1_1_ast_node.html#af2a895699bac2012f8b7739bff49c5ec">Clone</a>()-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a21324d298123937056c972179d03fade">CastToValue</a>();
<a name="l00572"></a>00572     <span class="keywordflow">if</span> ( value == 0 ) {
<a name="l00573"></a>00573       <a class="code" href="dsta__processor_8cc.html#a04742d7f90e8442694c6966153e818a2">ERROR</a>( info , <span class="stringliteral">&quot;CreateTmpVarDecl&quot;</span> );
<a name="l00574"></a>00574       <span class="keywordflow">return</span> 0;
<a name="l00575"></a>00575     }
<a name="l00576"></a>00576     <span class="keywordflow">if</span> ( value-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a6ecb0925a6380a375a92451256039d7f">ChildLength</a>() == 0 || value-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a65c6f1546ebb657cbfb265f372c183cd">FirstChild</a>()-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a930b6f930cbe0efddfde28ec73c200bc">NodeType</a>() == <a class="code" href="classmocha_1_1_ast_node.html#a7e049e71bcf600466f1c977205d8215ba511887c37cd4074434e34153e959d198">AstNode::kEmpty</a> ) {
<a name="l00577"></a>00577       <span class="keywordflow">if</span> ( value-&gt;<a class="code" href="classmocha_1_1_ast_node.html#a6ecb0925a6380a375a92451256039d7f">ChildLength</a>() &gt; 0 ) {
<a name="l00578"></a>00578         value-&gt;<a class="code" href="classmocha_1_1_ast_node.html#ababb12c547452f11a13727491d0a9f4b" title="Remove all child nodes.">RemoveAllChild</a>();
<a name="l00579"></a>00579       }
<a name="l00580"></a>00580       value-&gt;<a class="code" href="classmocha_1_1_ast_node.html#acada63e4d868960a7fbd972f3d3a0ae4">AddChild</a>( <a class="code" href="classmocha_1_1_ast_utils.html#a20a30d91e2013c43e91d20c01f6b4eb8">AstUtils::CreateObjectLiteral</a>( ManagedHandle::Retain&lt;Empty&gt;() ) );
<a name="l00581"></a>00581     }
<a name="l00582"></a>00582     value-&gt;<a class="code" href="classmocha_1_1_value_node.html#ae400f4a35352d1052dffc60290c290a0">ValueType</a>( <a class="code" href="classmocha_1_1_value_node.html#aeafe128bdaf5aac5d5bf31129b46bc1babcec8f8a2acd9a985dbd67c79f2ad9d5">ValueNode::kVariable</a> );
<a name="l00583"></a>00583     
<a name="l00584"></a>00584     var_list-&gt;<a class="code" href="classmocha_1_1_ast_node.html#acada63e4d868960a7fbd972f3d3a0ae4">AddChild</a>( value );    
<a name="l00585"></a>00585   }
<a name="l00586"></a>00586   <span class="keywordflow">return</span> <a class="code" href="classmocha_1_1_ast_utils.html#aa7d849cc4fe5b84c9aa80c81904931fb">AstUtils::CreateVarStmt</a>( var_list );
<a name="l00587"></a>00587 }
<a name="l00588"></a>00588 
<a name="l00589"></a>00589 
<a name="l00590"></a>00590 }
</pre></div></div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Thu Feb 16 2012 23:50:16 for mocha by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
