<div class="titile">
    <h2>First Step Guide</h2>
</div>
<div class="row">
    <div class="span4">
	<div class="tabbable tabs-left">
	    <ul class="nav nav-tabs grammar_list">
		<li class="active"><a data-toggle="tab" href="#running-mocha">Runnning mocha</a></li>
		<li><a data-toggle="tab" href="#config-js">config.js</a></li>
		<li><a data-toggle="tab" href="#compilation-setting">compilation setting</a></li>
		<li><a data-toggle="tab" href="#commands">commands</a></li>
		<li><a data-toggle="tab" href="#compiler-directive">compiler directive</a></li>
		<li><a data-toggle="tab" href="#use-phantomjs">use phantomjs</a></li>
	    </ul>
	</div>
</div>
<div class="span8">
    <div class="tab-content">
	<div id="running-mocha" class="tab-pane active">
	    <h3>Running mocha</h3>
	    <p>mochaの基本的な使用方法です。まず、ターミナル、あるいはコマンドプロンプトを起動します。その後、</p>
	    <pre class="prettyprint grammars"><code>cd &lt;mochaの実行ファイルのあるディレクトリ&gt;</code></pre>
	    <p>と入力し、ディレクトリを移動します。移動先のディレクトリで、</p>
	    <pre class="prettyprint grammars"><code>mchd</code></pre>
	    <p>と入力し、mochaを起動します。すると、</p>
	    <pre class="prettyprint grammars"><code>mocha es-next-compiler(stand-alone)
usage -> run 'help'
>></code></pre>
	    <p>このようなプロンプトが表示されます。この状態で、pcのuserディレクトリを見ると、.mochaというディレクトリができているはずです。このディレクトリの中身は以下のような構成になっています。</p>
<pre class="prettyprint grammars"><code>.mocha
     |_config.js
     |_mocha.log</code></pre>
	    <p>config.jsの中を見てみましょう。デフォルトでは以下のようになっているはずです。</p>
<pre class="prettyprint grammars"><code>config.set('compileSettingPath', './watch.js')
config.set('logFilePath', './mocha.log')</code></pre>
	    <p>watch.jsが実装する必要のあるファイルです。.mochaの中にwatch.jsファイルを作ります。watch.js内では監視するjsファイルを、mochaの設定に追加していきます。以下がサンプルです。</p>

<pre class="prettyprint grammars"><code>var script = mocha.import('script');
script.watcher.addSetting('/home/foo/src/test.js', {
  deployDir : '/home/foo/src/deploy',
  deployName : 'test-deploy.js',
  outputCharset : 'utf8',
  inputCharset : 'utf8',
  options : {
    compress : false,
    prettyPrint : true,
    debug : true,
    versions : [],
    fileScope : true,
    globalScope : true
  }
})</code></pre>
	    <p>上記の記述で'/home/foo/src/test.js'が監視されます。test.jsを修正するたびに、'/home/foo/src/deploy/'フォルダに、'test-deploy.js'という名前でコンパイル済みファイルが保存されます。その後、mochaのコンソールで、</p>
<pre class="prettyprint grammars"><code>>> .restart()</code></pre>
	    <p>と入力し、watch.jsを読み込ませます。これでtest.jsの監視が始まります。</p>
	    <p>以上が基本的なステップです。</p>
	</div>
	<div id="config-js" class="tab-pane">
	    <h3>config.js</h3>
	    <p>mochaが初回起動時に生成する&lt;user_home&gt;/.mocha/config.jsの解説です。</p>
	    <p>&lt;user_home&gt;は</p>
	    <dl>
		<dt>windows xp</dt> 
		<dd><pre class="prettyprint"><code>C:\Document and Setting\<ユーザー名>\</code></pre></dd>
		<dt>windows vista or later</dt>
		<dd><pre class="prettyprint"><code>C:\Users\<ユーザー名>\</code></pre></dd>
		<dt>osx</dt>
		<dd><pre class="prettyprint"><code>/Users/<ユーザー名></code></pre></dd>
		<dt>linux</dt>
		<dd><pre class="prettyprint"><code>/home/<ユーザー名></code></pre></dd>
	    </dl>
	    <p>になります。 </p>
	    <p>config.js内ではグローバルスコープにconfigオブジェクトが定義されます。このconfigオブジェクトに設定を追加することで、mochaの設定を行います。</p>
	    <p>以下にmochaの生成するデフォルトのconfig.jsを提示します。</p>
	    <pre class="prettyprint"><code>config.set('compileSettingPath', './compile_setting.js');
config.set('logFilePath', './mocha.log');</code></pre>
	    <p>mochaはcompileSettingPathとlogFilePathプロパティを設定するファイルを生成します。以下がconfigオブジェクトに設定可能な値です。</p>
	    <table>
		<tr>
		    <th>名前</th>
		    <th>説明</th>
		</tr>
		<tr><td>compileSettingPath</td><td>jsファイルのコンパイル設定が記述されたファイルの場所です。</td></tr>
		<tr><td>logFilePath</td><td>ログファイルが格納される場所です。</td></tr>
		<tr><td>phantomInstallDir</td><td>phantomjsがインストールされている場所です。</td></tr>
	    </table>
	</div>
	<div id="compilation-setting" class="tab-pane">
	    <h3>compilation setting</h3>
	    <p>コンパイルの設定を記述するファイルです。configオブジェクトのcompileSettingPathによって場所が設定されます。このファイルは起動時に指定された場所から自動で読み込まれます。デフォルトではwatch.jsというファイル名になっています。</p>
	    <p>サンプル</p>
 	    <pre class="prettyprint grammars"><code>//scriptモジュールをインポート
var watcher = mocha.import('script').watcher;
//設定の追加
//対象のファイルネーム
watcher.addSetting("src/test.js", {
  //deployするディレクトリ
  deployDir : 'src/deploy',
  //deployする際のファイルネーム
  deployName : 'test-deploy.js',
  //ファイルのエンコーディング
  inputCharset : 'utf-8',
  //出力されるファイルのエンコーディング
  outputCharset : 'utf-8',
  //コンパイルオプション
  options : {
    //人間の読みやすい形にする
    prettyPrint : true,
    //圧縮しない
    compress : false,
    //デバッグモードでコンパイル
    debug : true,
    //各ファイル単位でスコープの生成
    fileScope : true,
    //グルーバルスコープの生成
    globalScope : true
  }
})</code></pre>
	    <p>基本的にはscriptモジュールのwatcherオブジェクトのaddSetting関数にファイル名、設定を追加していく形になります。以下が設定のフォーマットです。</p>
	    <table>
		<tr>
		    <th>プロパティ名</th>
		    <th>データタイプ</th>
		    <th>説明</th>
		</tr>
		<tr>
		    <td>deployDir</td><td>String</td><td>コンパイル結果を出力する場所です。</td>
		</tr>
		<tr>
		    <td>deployName</td><td>String</td><td>コンパイル結果のファイル名です。</td>
		</tr>
		<tr>
		    <td>inputCharset</td><td>String</td><td>元ファイルのエンコーディングです。</td>
		</tr>
		<tr>
		    <td>outputCharset</td><td>String</td><td>出力ファイルのエンコーディングです。</td>
		</tr>
		<tr>
		    <td>options</td><td>Object</td><td>コンパイルのオプションを指定します。</td>
		</tr>
	    </table>
	    <p>optionsの中身です。</p>
	    <table>
		<tr>
		    <th>プロパティ名</th>
		    <th>データタイプ</th>
		    <th>説明</th>
		</tr>
		<tr>
		    <td>prettyPrint</td><td>Boolean</td><td>出力をフォーマットします。</td>
		</tr>
		<tr>
		    <td>compress</td><td>Boolean</td><td>出力を圧縮します。</td>
		</tr>
		<tr>
		    <td>debug</td><td>Boolean</td><td>デバッグモードで実行します。</td>
		</tr>
		<tr>
		    <td>moduleDir</td><td>Array</td><td>モジュールをロードするディレクトリを設定します。</td>
		</tr>
		<tr>
		    <td>versions</td><td>Array</td><td>バージョンを指定します。</td>
		</tr>
		<tr>
		    <td>fileScope</td><td>Boolean</td><td>ファイル単位でスコープを生成するかどうか指定します。デフォルトではtrueです。</td>
		</tr>
		<tr>
		    <td>globalScope</td><td>Boolean</td><td>グローバルなスコープを生成するかどうか指定します。デフォルトではtrueです。</td>
		</tr>
	    </table>
	</div>
	<div id="commands" class="tab-pane">
	    <h3>commands</h3>
	    <p>mochaは設定ファイルの追加の際にコマンド設定の追加も可能です。コマンドは以下の方法で追加できます。</p>
	    <pre class="prettyprint grammars"><code>mocha.addCommand('foo', function () {
  console.log('test');
}, 'test command!!');</code></pre>
	    <p>mocha.addCommandは第一引数にコマンド名、第二引数にコールバック関数、第三引数に説明を記述します。
追加したコマンドは端末上から呼び出す事が可能になります。</p>
	    <p>先ほどのfooコマンドを呼び出すには以下のようにします。</p>
	    <pre class="prettyprint"><code>>> .foo()</code></pre>
	    <p><strong>組み込みコマンド</strong></p>
	    <p>mochaは以下のコマンドをデフォルトで持っています。</p>
	    <table>
		<tr>
		    <th>名前</th>
		    <th>インターフェース</th>
		    <th>機能</th>
		</tr>
		<tr>
		    <td>watch</td><td>watch()</td><td>監視を再開します。|</td>
		</tr>
		<tr>
		    <td>unwatch</td><td>unwatch()</td><td>監視を停止します。</td>
		</tr>
		<tr>
		    <td>restart</td><td>restart()</td><td>再度設定ファイルを読み込みます。</td>
		</tr>
		<tr>
		    <td>deploy</td><td>deploy([predicate], [option])</td><td>指定したファイルをコンパイルします。predicateには関数か、文字列、正規表現を指定します。</td>
		</tr>
		<tr>
		    <td>test</td><td>test([predicate], [option])</td><td>指定したファイルをテストします。predicateには関数か、文字列、正規表現を指定します。</td>
		</tr>
		<tr>
		    <td>settingList</td><td>settingList([showDeploy], [showOpt], [predicate])</td><td>mochaの監視下にあるファイルの一覧を表示します。showDeployが指定されるとdeploy情報を、showOptが指定されるとコンパイルオプションをそれぞれ追加で表示します。predicateには関数か、文字列、正規表現を指定します。</td>
		</tr>
		<tr>
		    <td>help</td><td>help()</td><td>コマンド一覧を表示します。</td>
		</tr>
		<tr>
		    <td>exit</td><td>exit()</td><td>mochaを終了します。</td>
		</tr>
	    </table>
	</div>
	<div id="compiler-directive" class="tab-pane">
	    <h3>compiler directive</h3>
	    <p>mochaはES Nextの文法に加え以下の独自拡張を持っています。</p>
	    <table>
		<tr>
		    <th>名前</th>
		    <th>インターフェース</th>
		    <th>機能</th>
		</tr>
		<tr>
		    <td>@assert</td><td>@assert(expect, expression)</td><td>アサーションの実行です。versionにdebugが定義されている時のみコード生成されます。</td>
		</tr>
		<tr>
		    <td>@version</td><td>@version(version){...}</td><td>バージョン分岐ブロックを生成します。</td>
		</tr>
		<tr>
		    <td>@include</td><td>@include &lt;filename&gt;</td><td>ファイルを読み込み、その場所に展開します。いっさいのコンパイルは行われません。</td>
		</tr>
	    </table>
	    <p>@assert</p>
	    <pre class="prettyprint grammars"><code>test(x,y) -> x + y;
@assert(true, test(1,1) === 2);
//このように展開される
Runtime.assert(true, test(1,1) === 2, 'test(1,1) === 2', 'filename', 'linenumber')</code></pre>
	    <p>@version</p>
	    <pre class="prettyprint grammars"><code>var x = 0;
@version(debug) {
  x = 1;
}
@version(release) {
  x = 2;
}
//デバッグモードの時はx = 1
//リリースモードの時はx = 2</code></pre>
	    <p>@include</p>
	    <pre class="prettyprint grammars"><code>@include 'jQuery-min.js'
$(->{
...
})
//@includeの部分にjQueryのコードがそのまま挿入される</code></pre>
	</div>
	<div id="use-phantomjs" class="tab-pane">
	    <h3>use phantomjs</h3>
	    <p>mochahはphantomjsgがインストールされていれば、直接起動が可能です。phantomjsはコマンドラインから使用できるwebkitでcssやhtmlもフルで使用可能です。</p>
	    <p><strong>phantomjsnの指定方法</strong></p>
	    <p>config.js内に</p>
	    <pre class="prettyprint"><code>cofig.set('phantomInstallDir', '<phantomjsのインストール先>');</code></pre>
	    <p>の記述を追加します。あとは組み込みコマンドの.test()を使うと起動できます。.test()実行時にはversionsの値にtestという値が追加されます。</p>
	    <p><strong>テスト</strong></p>
	    <p>mocha自体はテスト機能を持たないのですが、既存のテストフレームワークを利用できます。jasmine,JsUnitなど。</p>
	</div>
    </div>
</div>

